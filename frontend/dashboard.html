<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sports Numerology API</title>
    <!-- No CSS - style it yourself -->
</head>
<body>
    <header>
        <nav>
            <a href="index.html">üîÆ Sports Numerology</a>
            <div>
                <a href="index.html">Home</a>
                <span id="user-email"></span>
                <button onclick="logout()">Logout</button>
            </div>
        </nav>
    </header>

    <main>
        <header>
            <h1>Dashboard</h1>
            <p>Manage your API keys and monitor usage</p>
        </header>

        <section>
            <article>
                <header>
                    <h2>üìä Usage Statistics</h2>
                </header>
                <section>
                    <figure>
                        <figcaption>Today</figcaption>
                        <data id="today-requests">0</data>
                    </figure>
                    <figure>
                        <figcaption>This Month</figcaption>
                        <data id="month-requests">0</data>
                    </figure>
                    <figure>
                        <figcaption>Total</figcaption>
                        <data id="total-requests">0</data>
                    </figure>
                </section>
                <footer>
                    <p>Plan: Free (10 / day)</p>
                    <progress id="usage-bar" value="0" max="10"></progress>
                </footer>
            </article>

            <article>
                <header>
                    <h2>üîê API Keys</h2>
                    <button onclick="showCreateKeyModal()">+ Generate New Key</button>
                </header>
                <p>Use these keys to authenticate your API requests. Keep them secret!</p>
                <section id="api-keys-list">
                    <!-- API keys loaded here -->
                </section>
            </article>
        </section>

        <section>
            <header>
                <h2>üìö Resources</h2>
            </header>
            <article>
                <a href="#">
                    <h3>üìñ API Documentation</h3>
                    <p>View endpoints & examples</p>
                </a>
            </article>
            <article>
                <a href="#">
                    <h3>üíª Code Examples</h3>
                    <p>Python, JavaScript, & more</p>
                </a>
            </article>
            <article>
                <a href="index.html#demo">
                    <h3>üéæ Try Demo</h3>
                    <p>Test the API without code</p>
                </a>
            </article>
        </section>
    </main>

    <dialog id="create-key-modal">
        <article>
            <header>
                <h2>Generate New API Key</h2>
            </header>
            <fieldset>
                <label>Key Name (optional)</label>
                <input type="text" id="key-name" placeholder="My App">
            </fieldset>
            <footer>
                <button onclick="closeCreateKeyModal()">Cancel</button>
                <button onclick="generateApiKey()">Generate</button>
            </footer>
        </article>
    </dialog>

    <dialog id="show-key-modal">
        <article>
            <header>
                <h2>Your New API Key</h2>
            </header>
            <p>Copy this key now. You won't be able to see it again!</p>
            <code id="new-api-key"></code>
            <footer>
                <button onclick="copyApiKey()">Copy</button>
                <button onclick="closeShowKeyModal()">Done</button>
            </footer>
        </article>
    </dialog>

    <script>
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (user.email) {
            document.getElementById('user-email').textContent = user.email;
        }

        async function loadApiKeys() {
            try {
                const response = await fetch('/api-keys', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to load keys');
                
                const apiKeys = await response.json();
                renderApiKeys(apiKeys);
                updateUsageStats();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function renderApiKeys(apiKeys) {
            const container = document.getElementById('api-keys-list');
            
            if (apiKeys.length === 0) {
                container.innerHTML = '<p>No API keys yet. Generate one to get started.</p>';
                return;
            }
            
            container.innerHTML = apiKeys.map(key => `
                <article>
                    <h3>${key.name || 'Unnamed Key'}</h3>
                    <code>${key.api_key}</code>
                    <p>Created: ${new Date(key.created_at).toLocaleDateString()}</p>
                    <button onclick="revokeKey('${key.id}')">Revoke</button>
                </article>
            `).join('');
        }

        function updateUsageStats() {
            document.getElementById('today-requests').textContent = Math.floor(Math.random() * 5);
            document.getElementById('month-requests').textContent = Math.floor(Math.random() * 50);
            document.getElementById('total-requests').textContent = Math.floor(Math.random() * 200);
            document.getElementById('usage-bar').value = 3;
        }

        function showCreateKeyModal() {
            document.getElementById('create-key-modal').showModal();
        }

        function closeCreateKeyModal() {
            document.getElementById('create-key-modal').close();
        }

        async function generateApiKey() {
            const name = document.getElementById('key-name').value;
            
            try {
                const response = await fetch('/api-keys', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: name || 'My App' })
                });
                
                if (!response.ok) throw new Error('Failed to create key');
                
                const data = await response.json();
                
                closeCreateKeyModal();
                document.getElementById('new-api-key').textContent = data.api_key;
                document.getElementById('show-key-modal').showModal();
                
                loadApiKeys();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function closeShowKeyModal() {
            document.getElementById('show-key-modal').close();
        }

        function copyApiKey() {
            const key = document.getElementById('new-api-key').textContent;
            navigator.clipboard.writeText(key).then(() => {
                alert('Copied to clipboard!');
            });
        }

        async function revokeKey(keyId) {
            if (!confirm('Are you sure? This action cannot be undone.')) return;
            
            try {
                const response = await fetch(`/api-keys/${keyId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to revoke key');
                
                loadApiKeys();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        loadApiKeys();
    </script>
</body>
</html>
