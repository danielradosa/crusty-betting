<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sports Numerology API</title>
    <!-- No CSS - style it yourself -->
</head>
<body class="bg-bg min-h-screen">
    <!-- Navigation -->
    <nav class="navbar py-4 border-b border-border">
        <div class="container flex justify-between items-center">
            <a href="index.html" class="logo text-xl font-bold">üîÆ Sports Numerology</a>
            <div class="nav-links flex items-center gap-6">
                <a href="index.html" class="text-text-muted hover:text-text transition">Home</a>
                <span id="user-email" class="text-text-muted text-sm"></span>
                <button onclick="logout()" class="btn btn-secondary px-4 py-2">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="container py-8 max-w-6xl mx-auto px-4">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Dashboard</h1>
            <p class="text-text-muted">Manage your API keys and monitor usage</p>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Usage Stats -->
            <div class="glass-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4">üìä Usage Statistics</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary-light" id="today-requests">0</div>
                        <div class="text-text-muted text-sm">Today</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary-light" id="month-requests">0</div>
                        <div class="text-text-muted text-sm">This Month</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary-light" id="total-requests">0</div>
                        <div class="text-text-muted text-sm">Total</div>
                    </div>
                </div>
                <div class="border-t border-border pt-4">
                    <div class="flex justify-between text-sm mb-2">
                        <span class="text-text-muted">Plan: <span class="text-primary-light font-semibold">Free</span></span>
                        <span class="text-text-muted">10 / day</span>
                    </div>
                    <div class="w-full h-2 bg-bg-lighter rounded-full overflow-hidden">
                        <div id="usage-bar" class="h-full bg-gradient-to-r from-primary to-primary-light transition-all" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- API Keys -->
            <div class="glass-card p-6 rounded-lg md:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">üîê API Keys</h3>
                    <button onclick="showCreateKeyModal()" class="btn btn-primary px-4 py-2 text-sm">+ Generate New Key</button>
                </div>
                <p class="text-text-muted text-sm mb-4">Use these keys to authenticate your API requests. Keep them secret!</p>
                <div id="api-keys-list" class="space-y-3">
                    <!-- API keys loaded here -->
                </div>
            </div>
        </div>

        <!-- Resources -->
        <div class="glass-card p-6 rounded-lg">
            <h3 class="text-lg font-semibold mb-4">üìö Resources</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <a href="#" class="flex items-center gap-4 p-4 bg-bg-lighter rounded-lg hover:bg-bg-light transition">
                    <span class="text-2xl">üìñ</span>
                    <div>
                        <div class="font-semibold">API Documentation</div>
                        <div class="text-text-muted text-sm">View endpoints & examples</div>
                    </div>
                </a>
                <a href="#" class="flex items-center gap-4 p-4 bg-bg-lighter rounded-lg hover:bg-bg-light transition">
                    <span class="text-2xl">üíª</span>
                    <div>
                        <div class="font-semibold">Code Examples</div>
                        <div class="text-text-muted text-sm">Python, JavaScript, & more</div>
                    </div>
                </a>
                <a href="index.html#demo" class="flex items-center gap-4 p-4 bg-bg-lighter rounded-lg hover:bg-bg-light transition">
                    <span class="text-2xl">üéæ</span>
                    <div>
                        <div class="font-semibold">Try Demo</div>
                        <div class="text-text-muted text-sm">Test the API without code</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Create Key Modal -->
    <div id="create-key-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass-card max-w-md w-full mx-4 p-6 rounded-lg">
            <h3 class="text-xl font-bold mb-4">Generate New API Key</h3>
            <div class="mb-4">
                <label class="text-sm font-medium mb-2 block">Key Name (optional)</label>
                <input type="text" id="key-name" placeholder="My App" class="w-full px-4 py-3 bg-bg-lighter border border-border rounded-lg focus:border-primary focus:outline-none">
            </div>
            <div class="flex gap-3 justify-end">
                <button onclick="closeCreateKeyModal()" class="btn btn-secondary px-4 py-2">Cancel</button>
                <button onclick="generateApiKey()" class="btn btn-primary px-4 py-2">Generate</button>
            </div>
        </div>
    </div>

    <!-- Show Key Modal -->
    <div id="show-key-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass-card max-w-md w-full mx-4 p-6 rounded-lg">
            <h3 class="text-xl font-bold mb-2">Your New API Key</h3>
            <p class="text-text-muted text-sm mb-4">Copy this key now. You won't be able to see it again!</p>
            <div class="bg-bg-lighter p-4 rounded-lg mb-4 break-all font-mono text-sm" id="new-api-key"></div>
            <div class="flex gap-3 justify-end">
                <button onclick="copyApiKey()" class="btn btn-secondary px-4 py-2">Copy</button>
                <button onclick="closeShowKeyModal()" class="btn btn-primary px-4 py-2">Done</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '';
        let apiKeys = [];

        // Check auth
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        // Load user data
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (user.email) {
            document.getElementById('user-email').textContent = user.email;
        }

        // Load API keys
        async function loadApiKeys() {
            try {
                const response = await fetch(`${API_BASE_URL}/api-keys`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to load keys');
                
                apiKeys = await response.json();
                renderApiKeys();
                updateUsageStats();
            } catch (error) {
                console.error('Error loading API keys:', error);
            }
        }

        function renderApiKeys() {
            const container = document.getElementById('api-keys-list');
            
            if (apiKeys.length === 0) {
                container.innerHTML = '<p class="text-text-muted text-center py-4">No API keys yet. Generate one to get started.</p>';
                return;
            }
            
            container.innerHTML = apiKeys.map(key => `
                <div class="flex justify-between items-center p-4 bg-bg-lighter rounded-lg">
                    <div>
                        <div class="font-semibold">${key.name || 'Unnamed Key'}</div>
                        <div class="text-text-muted text-sm font-mono">${key.api_key}</div>
                        <div class="text-text-muted text-xs mt-1">
                            Created: ${new Date(key.created_at).toLocaleDateString()}
                            ${key.last_used ? `‚Ä¢ Used: ${new Date(key.last_used).toLocaleDateString()}` : ''}
                        </div>
                    </div>
                    <button onclick="revokeKey('${key.id}')" class="btn btn-danger px-3 py-1 text-sm">Revoke</button>
                </div>
            `).join('');
        }

        function updateUsageStats() {
            // Mock stats for now
            document.getElementById('today-requests').textContent = Math.floor(Math.random() * 5);
            document.getElementById('month-requests').textContent = Math.floor(Math.random() * 50);
            document.getElementById('total-requests').textContent = Math.floor(Math.random() * 200);
            document.getElementById('usage-bar').style.width = '30%';
        }

        function showCreateKeyModal() {
            document.getElementById('create-key-modal').classList.remove('hidden');
            document.getElementById('key-name').value = '';
        }

        function closeCreateKeyModal() {
            document.getElementById('create-key-modal').classList.add('hidden');
        }

        async function generateApiKey() {
            const name = document.getElementById('key-name').value.trim();
            
            try {
                const response = await fetch(`${API_BASE_URL}/api-keys`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: name || 'My App' })
                });
                
                if (!response.ok) throw new Error('Failed to create key');
                
                const data = await response.json();
                
                closeCreateKeyModal();
                document.getElementById('new-api-key').textContent = data.api_key;
                document.getElementById('show-key-modal').classList.remove('hidden');
                
                loadApiKeys();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function closeShowKeyModal() {
            document.getElementById('show-key-modal').classList.add('hidden');
        }

        function copyApiKey() {
            const key = document.getElementById('new-api-key').textContent;
            navigator.clipboard.writeText(key).then(() => {
                alert('Copied to clipboard!');
            });
        }

        async function revokeKey(keyId) {
            if (!confirm('Are you sure? This action cannot be undone.')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api-keys/${keyId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Failed to revoke key');
                
                loadApiKeys();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        // Close modals on overlay click
        document.getElementById('create-key-modal').addEventListener('click', e => {
            if (e.target === e.currentTarget) closeCreateKeyModal();
        });
        document.getElementById('show-key-modal').addEventListener('click', e => {
            if (e.target === e.currentTarget) closeShowKeyModal();
        });

        // Load data
        loadApiKeys();
    </script>
</body>
</html>
